<!-- THE HEADER -->
<header>
  <!-- Display flash messages -->
  <% if flash[:success] %>
    <div class="alert alert-success">
      <%= flash[:success] %>
    </div>
  <% elsif flash[:error] %>
    <div class="alert alert-warning">
      <%= flash[:error] %>
    </div>
  <% end %>

  <div class="container-fluid custom-container">
    <div class="row no_row row-header">
      
      <!-- Clickable icon on the top-left corner -->
      <div class="brand-be">
        <a href="/">
          <img class="logo-c active be_logo" src="<%= asset_path "new_logo.png" %>" alt="logo">
        </a>
      </div>

      <div class="header-menu-block">
        <ul class="header-menu" id="one"></ul>
      </div>

      <!-- Sign In/Sign Up Button Block -->
      <div class="login-header-block">
        <div class="login_block">
          <div class="login_block_rightup">
            <% if session[:current_user_key] %>
              <!-- User is logged in -->
              <div class="dropdown">
                <% if GeneralInfo.find_by(userKey: session[:current_user_key])&.notification %>
                  <button onclick="dropdown()" class="dropbtn" id="notif">
                    <i class="fa-regular fa-bell fa-xl fa-fw" style="color:#147efb"></i>
                  </button>
                  <div id="myDropdown" class="dropdown-content">
                    <% @notifications_from = GeneralInfo.find_by(userKey: session[:current_user_key]).notification_from %>
                    <% @notifications_from.each do |notification| %>
                      <a href="/dm/<%= notification %>">
                        <b><%= GeneralInfo.find_by(id: notification).first_name %> <%= GeneralInfo.find_by(id: notification).last_name %> sent you a message!</b>
                      </a>
                    <% end %>
                  </div>
                <% else %>
                  <button onclick="dropdown()" class="dropbtn" id="notif">
                    <i class="fa-regular fa-bell fa-xl fa-fw" style="color:black"></i>
                  </button>
                  <div id="myDropdown" class="dropdown-content">
                    <i class="fa-regular fa-circle-check fa-5x" style="color:black;padding:30px"></i>
                    <div style="color: black; height: 20px; overflow-wrap: break-word;">
                      <b>You're all caught up! No new messages.</b>
                    </div>
                  </div>
                <% end %>
              </div>
              <a href="/dm" class="dropbtn" id="dm">
                <i class="fa-regular fa-message fa-xl fa-fw" style="color:black"></i>
              </a>
              <a class="btn color-1 size-2 hover-2" href="/show_profile">My Profile</a>
              <%= link_to 'Log out', logout_path, method: :get, class: "btn color-1 size-2 hover-2" %>
            <% else %>
              <!-- User is not logged in -->
              <a href="<%= new_user_session_path %>" class="btn color-1 size-2 hover-2" id="sign_in">Sign In</a>
			  <a href="<%= new_user_registration_path %>" class="btn be-register color-1 size-2 hover-2" id="sign_up">Sign Up</a>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>

<!-- Custom Styles for Improved UI -->
<style>
  /* Styling input fields for separate rows */
  .login-header-block input[type="text"],
  .login-header-block input[type="password"] {
    display: block;
    width: 100%;
    margin-bottom: 15px;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 14px;
    color: black; /* Ensure black text color for readability */
    background-color: white;
  }

  .login-header-block label {
    font-size: 14px;
    font-weight: bold;
    color: black; /* Black font color for labels */
    margin-bottom: 5px;
  }

  /* Styling buttons */
  .btn {
    color: black;
    background-color: #f0f0f0;
    border: none;
    padding: 10px 20px;
    text-align: center;
    font-size: 14px;
    border-radius: 5px;
    cursor: pointer;
  }

  .btn:hover {
    background-color: #e0e0e0;
  }

  /* Additional Styles for dropdown */
  .dropdown-content {
    background-color: #f9f9f9;
    color: black;
    border: 1px solid #ddd;
    width: 200px;
    border-radius: 4px;
    padding: 10px;
  }

  /* Set Sign In/Sign Up text color to black */
  #sign_in, #sign_up {
    color: black;
  }

  /* Style the form container for improved layout */
  .form-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
    max-width: 400px;
    margin: auto;
  }

  .form-container input {
    width: 100%;
  }
</style>

<script>
  // Scroll to the bottom for messages
  var element = document.getElementById("messages");
  if (element) {
    element.scrollTop = element.scrollHeight;
  }

  // Toggle dropdown content for notifications
  function dropdown() {
    document.getElementById("myDropdown").classList.toggle("show");
  }

  // Close the dropdown if the user clicks outside of it
  window.onclick = function(event) {
    if (!event.target.matches('.dropbtn')) {
      const dropdowns = document.getElementsByClassName("dropdown-content");
      for (let i = 0; i < dropdowns.length; i++) {
        const openDropdown = dropdowns[i];
        if (openDropdown.classList.contains('show')) {
          openDropdown.classList.remove('show');
        }
      }
    }
  }
</script>
